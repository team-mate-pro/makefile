### This is a reference (complete) MAKE file setup
### Remove the functionalities you don't need

.PHONY: help start fast stop check check_fast fix tests dev_seed prod_seed ssh_stage deploy c cf f t ds ps

## --- Mandatory variables ---

docker-compose=docker compose
main-container-name=app
main-branch-name=master
secondary-branch-name=slave
vendor-dir=vendor/team-mate-pro/make/

help: ### Display available targets and their descriptions
	@echo "Usage: make [target]"
	@echo "Targets:"
	@awk 'BEGIN {FS = ":.*?### "}; /^[a-zA-Z_-]+:.*?### / {printf "\033[36m%-30s\033[0m %s\n", $$1, $$2}' $(MAKEFILE_LIST)
	@echo ""

## --- General ---

## Claude Code
include $(vendor-dir)claude/MAKE_CLAUDE_v1

# General git commands
include $(vendor-dir)git/MAKE_GIT_v1

# Docker
include $(vendor-dir)docker/MAKE_DOCKER_v1

# --- Backend ---

# Symfony +7
include $(vendor-dir)sf-7/MAKE_SYMFONY_v1

# PHPCS
include $(vendor-dir)phpcs/MAKE_PHPCS_v1

# PHPUNIT
include $(vendor-dir)phpunit/MAKE_PHPUNIT_v1

# PHPSTAN
include $(vendor-dir)phpstan/MAKE_PHPSTAN_v1

## --- Frontend ---

## --- Mandatory aliases ---

start: ### Full start and rebuild of the container
	./tools/dev/stop.sh
	./tools/dev/start.sh

fast: ### Fast start already built containers
	./tools/dev/fast.sh

stop: ### Stop all existing containers
	./tools/dev/stop.sh

check: ### [c] Should run all mandatory checks that run in CI and CD process
	make phpcs
	make phpstan
	make tests

check_fast: ### [cf] Should run all mandatory checks that run in CI and CD process skipping heavy ones like functional tests
	make phpcs_fix
	make phpcs
	make phpstan

fix: ### [f] Should run auto fix checks that run in CI and CD process
	make phpcs_fix

tests: ### [t] Run all tests defined in the project
	make tests_unit
	make tests_integration
	make tests_application

## --- Project related scripts ---

dev_seed: ### [ds] Seeds local environment
	$(docker-compose) exec -it app composer dev:seed

ssh_stage: ### SSH connection command
	ssh {}

c: check
cf: check_fast
f: fix
t: tests
ds: dev_seed